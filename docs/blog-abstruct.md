# Kindleの積読はもうおしまい！PDF化してNotebookLMで読む新しい読書スタイル 📚✨

## はじめに

「この本面白そう！ポチッ！」...数日後、「あれ、読む時間どこ...？🥺」  
Kindleライブラリに未読本が積み上がっていく現象、名前をつけたいくらいあるあるですよね。
そう、人はそれを **「Tundle（ツンドル）」** と呼ぶのです...（今名付けました）

そんな「Tundle」に悩むあなたに朗報です！🎉  
**Kindle本をサクッとPDF化して、話題のAIツール「NotebookLM」で爆速インプット**しちゃう、新しい読書スタイルを提案させてください！

通勤電車の中でも、寝る前の少しの時間でも、AIとおしゃべりしながら本の内容が頭に入ってくる...そんな魔法のような体験、してみませんか？✨

---

## 1. なんでTundleになっちゃうの？🤔

### よくあるお悩み
- 📚 買った本がTundleになっている（あるある...）
- ⏰ まとまった読書時間が取れない！
- 🔍 「あの話どこだっけ？」って探すのが面倒すぎる
- 📝 要点だけ知りたいのに、最初から読む気力がない...

### 目指すは「未来の読書スタイル」🚀
- ✅ AIに要約してもらって、サクッと理解！
- ✅ 「これってどういうこと？」ってAIに質問攻めできる！
- ✅ キーワード検索で、知りたい情報に瞬間移動！
- ✅ 自分だけのデジタル書斎（PDF）でスマート管理！

---

## 2. これが解決策！「Kindle to PDF Pipeline」 💪

今回作ったツールは、**Kindleの画面をキャプチャして、高精度OCRで文字を読み取り、きれいなPDFにする**までを全自動でやってくれます！🤖

<!-- TODO: 画像の挿入
【ここに全体の流れがわかる図解イラストを入れるとGood！】
Kindleの画面 → パシャパシャ撮影 → OCRで文字認識 → キレイなHTML/PDF完成！ 
という変換プロセスのフローチャート画像があると、読者がイメージしやすいです。
-->

### 魔法のワークフロー 🪄

1.  **Kindleアプリ（macOS）** 📖  
    Python(`pyautogui` + `Quartz`)が自動でページをめくってスクショ撮影！
    途中で止まっても大丈夫。リランすれば自動で続きから再開する「**賢いレジューム機能**」付き。

2.  **画像保存 & 整理** 🖼️  
    キャプチャした画像は専用の `images/` フォルダに整理。
    実は開発中に「色が反転するバグ（RGBとBGRの取り違え）」に遭遇しましたが、今はカラープロファイルも完璧です✨

3.  **YomiToku OCR** 👁️  
    ここが心臓部。日本語に特化したAI OCR「YomiToku」で画像を解析。
    縦書き、横書き、ルビまで...驚くほど正確にテキスト化します。
    GPU（Metal）対応なので、MacBookなら爆速で処理完了！

4.  **HTML化 & ビューワー生成** 🎨  
    OCR結果をモダンなブラウザで見れるビューワーに変換。
    **「左にオリジナル画像、右にOCRテキスト」**を並べて表示する「対照モード」を搭載。
    これでOCRの答え合わせも一瞬です。

5.  **PDF生成 (for AI & Humans)** 📄  
    用途に合わせて2種類のPDFを自動生成！
    - **Full PDF (for AI)**:  
      OCRテキストをベースに再構築された、AI分析に最適なPDFです。
      **NotebookLMでの読み取りエラー**を徹底的に回避するため、ファイルを指定ページ数で**自動分割**する機能を搭載。
      「ファイルが大きすぎて読み込めません」というAIあるあるエラーともおさらばです 👋
    - **Light PDF (for Humans)**:  
      スマホで読むための、画像を16階調グレースケールに圧縮した軽量版。

---

## 3. 技術的なこだわり（マニア向け） 🤓

### � 処理フロー図 (Mermaid)

全体のデータフローはこんな感じです。各ステップが疎結合になっていて、途中で止まっても再開しやすい設計になっています。

```mermaid
graph TD
    %% Actors
    User((User))
    Kindle[Kindle for Mac]
    NotebookLM[NotebookLM]

    subgraph Step1 [Step 1: Capture]
        S1_Resume{Resume Check}
        S1_Proc[Screen Capture & Crop]
        Images[("Images Folder\n(images/*.png)")]
    end

    subgraph Step2 [Step 2: OCR & HTML]
        S2_Resume{Resume Check}
        S2_Proc[YomiToku OCR]
        S2_Gen[HTML Generation]
        HtmlFiles[("HTML Folder\n(html/*.html)")]
        ViewerFiles[("Viewer Files\n(index.html, server.py)")]
    end

    subgraph Step3 [Step 3: PDF for AI]
        S3_Proc[Playwright Renderer]
        S3_Split[PDF Splitter]
        AiPdf[("AI PDF\n(book.pdf / book-*.pdf)")]
    end
    
    subgraph Step4 [Step 4: PDF for Humans]
        S4_Proc[Grayscale & Quantize]
        S4_Merge[Image Merge]
        LightPdf[("Light PDF\n(book_light.pdf)")]
    end

    %% Flow Connections
    User -->|Run Script| S1_Proc
    S1_Proc <-->|Page Turn / Screenshot| Kindle
    S1_Resume -.->|Check Exists| Images
    S1_Proc -->|Save| Images

    Images -->|Input| S2_Proc
    Images -->|Input| S4_Proc

    S2_Resume -.->|Check Exists| HtmlFiles
    S2_Proc --> S2_Gen
    S2_Gen -->|Save| HtmlFiles
    S2_Gen -->|Generate| ViewerFiles

    HtmlFiles -->|Input| S3_Proc
    S3_Proc --> S3_Split
    S3_Split -->|Save| AiPdf

    S4_Proc --> S4_Merge
    S4_Merge -->|Save| LightPdf

    %% Usage Links
    ViewerFiles -.->|Local Preview| User
    AiPdf -.->|Upload| NotebookLM
    LightPdf -.->|Mobile Read| User
```

### �🔍 検索機能の「自前実装」
最初はブラウザ上のJavaScriptだけで全文検索をしようとしたんですが、本1冊分のテキストデータって意外と重いんです...。
ブラウザが固まってしまう問題が発生しました 😱

そこで、Pythonの `http.server` を拡張して、超軽量な**「ローカル検索APIサーバー」**を内蔵させました！
ビューワーの検索窓に入力すると、バックグラウンドのPythonサーバーが瞬時に検索して結果を返します。
これにより、何百ページの専門書でもサクサク検索できるようになりました 🚀

### 🛡️ 堅牢な再開（レジューム）機能
「500ページの本をキャプチャしてる最中に、300ページ目でエラー落ち...」
そんな悲劇をなくすために、各ステップに強力なレジューム機能を実装しました。
- **Step 1 (キャプチャ)**: 既存の画像枚数をチェックし、Kindleの現在ページと比較して自動復帰
- **Step 2 (OCR)**: 処理済みのHTMLファイルを検知して、未処理分だけを計算

「放っておけば終わってる」という信頼感、大事ですよね。

### 👁️ 日本語OCR「YomiToku」の実力
ここが一番の推しポイント！💖 
一般的なOCRだと日本語が文字化けしたり、レイアウトが崩れがち...。
でも、このツールでは**「YomiToku」**という日本語に超強いエンジンを使っています。

<!-- TODO: 画像の挿入
【OCRの比較画像を入れる！（超重要＆効果大）】
左側に「元のKindleスクショ画像」、右側に「OCR変換後のHTML/PDF画像」を並べて配置してください。
「おぉ！元のレイアウトそのままじゃん！」と読者が驚くような比較画像がベストです。
YomiTokuの精度の高さ（段組み、表、図などが崩れていない様子）をアピールしましょう！
-->

- 縦書きも横書きもOK！
- 複雑なレイアウトや表組みも認識！
- Appleシリコン（M1/M2/M3）のGPUパワーで爆速処理！⚡

### 📄 NotebookLMに最適化されたPDF生成：劇的な改善の軌跡 🚀

#### 🤔 Step 3 で遭遇した疑問
Step3（PDF生成）の実装は、実は一度ならず二度も抜本的な改造を経ています。

最初、OCRで抽出したテキストをPlaywrightでPDF化してました。すると...

**「あれ？ファイルサイズが50MBもある！これNotebookLMに読み込めないじゃん...」**

157ページ分の本で、50MBのPDFが吐き出されるって、異常ですよね？😰

#### 💭 推理：何がファイルを膨らませているのか？

こんな仮説を立てました：

1. **テキストだけなら小さいハズ** → なぜこんなでかくなった？
2. **画像情報が混在？** → Playwrightの動きが怪しい...
3. **フォントデータ?** → PDFに丸ごと埋め込まれてる？
4. **ベクター描画？** → HTMLのスタイルがベクトル化されてる？

実は、Playwrightを使ったPDF生成は、**ブラウザレンダリング**をしているので、CSS装飾やボーダーなどが全部**ベクターグラフィックス化**されてしまうんです。
結果として、60%が「その他（ベクター描画）」になってる状態でした。

#### 🔬 実践1：「シンプルテキストなら小さいか検証」

最初の試みは、**ReportLabで直接テキストをDraw**する方式に切り替えること。
HTML/CSSを無視して、純粋にテキスト行ごとに矩形を引いて配置する...そんな感じです。

```python
# ReportLab版：テキスト中心、HTMLレイアウトは無視
from reportlab.pdfgen import canvas
from reportlab.lib.pagesizes import A1

c = canvas.Canvas("output.pdf", pagesize=A1)
for line in extracted_text:
    c.drawString(x, y, line)
c.save()
```

**結果：3.3MB！** ✨（157ページで21 KB/ページ）

「よし、だいぶ小さくなった！」と思ったんですが...

#### 😅 プロト1の問題：HTMLレイアウト完全喪失

ここで気づきました。

「あ、テーブルがテキストになってる...」😭

KindleキャプチャをいったんHTMLにして、表組みやインデンテーションの情報を保存したのに、ReportLabで**全部テキスト化**しちゃったから、元のレイアウトが完全に吹き飛んでました。

**「ファイルは小さくなったけど、使い物にならない」** ← これです。

#### 🤓 推理2：「HTMLレイアウト維持 + 小ファイルサイズ」は両立できる？

ここで、エンジニア的な絶望感...😔  
「テキスト抽出は小さいけど情報喪失。Playwright はレイアウト完璧だけど肥大化。...詰みじゃん」

でも、世の中はそんなに甘くないはずない。他に方法があるはず...！

調べまくった結果、見つけたのが **WeasyPrint** という魔法のツール。

> **WeasyPrint** =「HTML/CSSを読み込んで、きれいなPDFを生成する」だけのシンプルなツール。
> Playwrightと違って、ブラウザをシミュレートせず、「HTMLパーサー → CSSレイアウトエンジン → PDF生成」という直線的なフロー。
> だから...ベクター描画の無駄がない！🎯

#### 🔬 実践2：「WeasyPrint でHTMLレイアウト維持＋小ファイル化」検証

待ちに待った検証です。157ページ全部で試してみました：

```python
# WeasyPrint版：HTML完全保持、直結PDF生成
from weasyprint import HTML, CSS

html_content = """
<table>
  <tr><td>セル1</td><td>セル2</td></tr>
  ...
</table>
"""

HTML(string=html_content).write_pdf('output.pdf')
```

**結果：1.52MB！** 🤯（157ページで9.9 KB/ページ）

- ✅ HTMLレイアウト完全保持（テーブル、インデント、段組み全部OK）
- ✅ ファイルサイズ: ReportLab比で **55%削減**（3.3MB → 1.52MB）
- ✅ Playwright比で **97%削減**（50MB → 1.52MB）
- ✅ NotebookLMでの読み込みも問題なし！

**これだ！** 🎉

#### 📊 改善データ：Before / After 比較表

| 世代 | ツール | ファイルサイズ | KB/ページ | HTMLレイアウト | 特徴 |
|------|--------|-------------|----------|----------------|------|
| v1 | Playwright | 50MB 😭 | 318 | ✅ OK | ブラウザフル描画 = ベクター爆増 |
| v2 | ReportLab | 3.3MB ✨ | 21 | ❌ 喪失 | テキスト抽出のみ = 情報損失 |
| **v3** | **WeasyPrint** | **1.52MB** 🚀 | **9.9** | **✅ 完全保持** | **直結PDF = 最適解** |

#### 💡 なぜWeasyPrintはこんなに小さいの？

簡潔に言うと：

1. **ベクター描画を避ける** → CSSを「指示」として解釈し、最終的なPDF命令に直結
2. **フォント埋め込みを最小化** → 必要なグリフだけを埋め込み
3. **リソース圧縮** → 画像があればその最適化もやってくれる

つまり、Playwrightが「ブラウザのように完璧に描画する」のに対して、
WeasyPrintは「HTML/CSSの仕様をPDFで忠実に実現する」という、**PDF生成に最適化**された設計なんです。

#### ✨ 現在のStep3の実装

```python
from weasyprint import HTML, CSS, FontConfiguration

# HTML全部を結合
combined_html = """
<html>
  <head>
    <style>
      @page {
        size: A1;
        margin: 25mm;
      }
      table {
        border-collapse: collapse;
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <!-- 全HTMLを結合して挿入 -->
  </body>
</html>
"""

# さらに自動分割対応（NotebookLM用）
if pages_per_file > 0:
    # 50ページごとに別PDFファイルにする機能
    write_pdf(combined_html, f"output-001.pdf", pages_per_file=50)
    write_pdf(combined_html, f"output-002.pdf", pages_per_file=50)
    ...
```

#### 🎯 メリット全部載せ

1. **NotebookLM最適化** → A1サイズで1HTML = 1ページ、分割対応で200MB制限クリア 🎯
2. **高速生成** → 157ページで8分（前：30分）⚡
3. **レイアウト完全保持** → 表組み、インデントもそのまま 📐
4. **ファイル小さい** → 1.52MBで最強の知識データベース完成！ 💎

---

## 4. 実際にやってみよう！ 🏃‍♂️

使い方はとってもシンプル。ターミナルでコマンドを叩くだけ！💻

### インストール

```bash
# リポジトリを持してくる
git clone https://github.com/6in/tundle.git
cd kindle-capture

# 準備完了！
uv sync
uv run playwright install chromium
```

### ワンコマンドで魔法発動 ✨

```bash
# これだけで、キャプチャからPDF作成まで全部やってくれます！
./kindle-to-pdf.sh --max-pages 100 \
  --pages-per-file 50 \
  --crop-top 70 --crop-bottom 40 --crop-right 40 \
  --pdf-filename "タイトル.pdf" \
  --wait 2.0
```

<!-- TODO: 画像の挿入
【実行中のターミナル画面のGIF動画、またはスクリーンショット】
ログが流れて処理が進んでいく様子を見せることで、「エンジニアっぽくてカッコいい！」「本当に自動で動いてる！」というワクワク感を伝えます。
-->

---

## 5. NotebookLMで広がる読書の世界 🌍

出来上がったPDFをNotebookLMにアップロードすると...？

<!-- TODO: 画像の挿入
【NotebookLMの画面キャプチャ】
実際に生成されたPDFをアップロードして、チャット画面でAIと会話している画像を入れましょう。
「この本の要約をして」「〇〇について教えて」と質問して、AIが賢く回答している様子を見せると、利用イメージが湧きます！
-->

### こんな使い方ができます！
1.  **「3行で要約して！」** 📝  
    忙しい朝も、サクッと内容把握。
2.  **「この章の〇〇について詳しく教えて」** 🙋‍♀️  
    分からないところだけ深掘り学習。
3.  **「関連する情報を探して」** 🔍  
    ページをパラパラめくらなくても、一瞬で該当箇所へ。
4.  **「学習プランを作って」** 📅  
    本の内容を元に、あなただけの先生になってくれます。

---

## 6. 実録：800ページの極厚技術書に挑んでみた 🔥

実際に821ページもある技術書をPDF化してみました。

- **キャプチャ**: 約10分 📸
- **OCR変換**: 約15分（GPUフル稼働！）🏎️
- **PDF生成**: 約8分（50ページ単位で分割）📄
- **結果**: 17個のPDFファイルが完成！（NotebookLMの解析安定性を重視）

これをNotebookLMに突っ込んだら...**最強のデータベース爆誕**です！🤯
検索も爆速だし、何より重たい本を持ち歩 かなくていいのが最高すぎます。

---

## 7. メリット・デメリット（正直に言います！）🤫

### 最高なところ 👍
- **時短！**: AI要約でインプット速度が倍増🚀
- **検索性！**: 情報を探すストレスがゼロに
- **自由！**: トリミングや分割サイズも自分好みに
- **資産化！**: 買った本がずっと使える知識データに

### 気をつけるところ ⚠️
- **自己責任で！**: Kindleの利用規約に抵触する恐れがあります。アカウント停止などのリスクを理解した上で、**完全に個人の責任**で利用してくださいね🙏
- **著作権**: あくまで**自分専用（私的利用）**で楽しんでくださいね！誰かに配ったりしちゃダメ絶対！🙅‍♂️
- **ちょっと時間はかかる**: 寝てる間に仕掛けておくのが吉💤
- **ファイルサイズ**: 画質重視なのでちょっと大きめ
- **Mac限定**: Windowsユーザーの方、ごめんなさい🙏（いつか対応したい！）

---

## まとめ

「Tundle」を「知識」に変える魔法のツール、いかがでしたか？

**読む**だけじゃなく、**AIと会話する**読書。
これからのスタンダードになる予感がします✨

あなたのKindleライブラリに眠っている本たちを、ぜひこのツールで呼び覚ましてあげてください！
きっと新しい発見が待っていますよ！🌈

---

## リンク集 🔗

- **GitHubリポジトリ**: https://github.com/yourusername/kindle-capture
- **NotebookLM**: https://notebooklm.google/

### 参考・リスペクト 🫡
- **[Kindle書籍をOCRかけてPDF化し、NotebookLMに読み込ませる（Windows編）](https://note.com/lytton_life/n/n523c648fad71?sub_rt=share_sb)**
  - 本ツール開発のきっかけとなった素晴らしい記事です。こちらはWindows環境での実装・解説をされています。「Macでもやりたい！」という強い思いから、今回Mac版を開発しました。

### YomiTokuの紹介ページ 📘
- **[YomiToku 紹介記事（開発者ノート）](https://note.com/kotaro_kinoshita/n/n70df91659afc)**
    - 本ツールで使っている日本語OCRエンジンの紹介記事です。精度や特徴が詳しくまとまっています。

---

## 🚨 【重要】ご利用上の注意と免責事項 🚨

**本ツールの利用は、ユーザーご自身の責任において行われるものとします。**
以下のリスクを十分にご理解いただいた上で、慎重にご判断ください。

1.  **Kindle利用規約への抵触**
    本ツールによるスクリーンショットの自動化やOCR処理は、Amazon Kindleの利用規約（リバースエンジニアリングの禁止やコンテンツの使用制限など）に抵触する可能性があります。

2.  **アカウントへのリスク**
    規約違反と判断された場合、**アカウントの停止（BAN）**や購入済みコンテンツの利用不可などのペナルティを受けるリスクがあります。

3.  **著作権法について**
    生成されたデータは、著作権法が認める**「私的利用」の範囲内**でのみ使用してください。友人への共有、インターネットへのアップロード、販売などは法律で固く禁じられています。

4.  **開発者の免責**
    本ツールを使用した結果生じたいかなる損害（アカウント停止、法的トラブル、データ損失など）についても、開発者は一切の責任を負いません。

技術的な実験・学習を目的としたプロジェクトですが、実運用におかれましては**「完全自己責任」**であることを強く意識してください🙇‍♂️

---
**Happy Reading!** 📖✨
**最終更新**: 2026年2月7日
